var accounts=[],emailTypes=[];function loadEmailTypes(){api.email_types.get().success((function(e){emailTypes=e;var a=$("#type");a.empty(),a.append('<option value="">-- Select Type --</option>'),$.each(e,(function(e,t){a.append('<option value="'+escapeHtml(t.value)+'">'+escapeHtml(t.display_name)+"</option>")}))})).error((function(){errorFlash("Error loading email types")}))}function save(e){var a={};a.email=$("#email").val(),a.email_type=$("#type").val(),a.is_active=$("#is_active").prop("checked"),-1!=e?(a.id=accounts[e].id,api.email_accounts.put(a).success((function(e){successFlash("Email account updated successfully!"),load(),dismiss()})).error((function(e){modalError(e.responseJSON.message)}))):api.email_accounts.post(a).success((function(e){successFlash("Email account added successfully! n8n OAuth2 credential created: "+e.n8n_credential_name+". Configure OAuth2 in n8n UI."),load(),dismiss()})).error((function(e){modalError(e.responseJSON.message)}))}function dismiss(){$("#modal\\.flashes").empty(),$("#email").val(""),$("#type").val(""),$("#is_active").prop("checked",!0),$("#modal").modal("hide")}function edit(e){if($("#modalSubmit").unbind("click").click((function(){save(e)})),-1==e)$("#modalLabel").text("New Sending Profile"),dismiss(),$("#modal").modal("show");else{$("#modalLabel").text("Edit Sending Profile");var a=accounts[e];$("#email").val(a.email),$("#type").val(a.email_type),$("#is_active").prop("checked",a.is_active),$("#modal").modal("show")}}function deleteAccount(e){Swal.fire({title:"Are you sure?",text:"This will delete the sending profile. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete Profile",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise((function(a,t){api.email_accounts.delete(accounts[e].id).success((function(e){a()})).error((function(e){t(e.responseJSON.message)}))}))}}).then((function(e){e.value&&Swal.fire("Sending Profile Deleted!","This sending profile has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))}function load(){$("#accountsTable").hide(),$("#emptyMessage").hide(),$("#loading").show(),api.email_accounts.get().success((function(e){accounts=e,$("#loading").hide(),accounts.length>0?($("#accountsTable").show(),accountsTable=$("#accountsTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]}),accountsTable.clear(),$.each(accounts,(function(e,a){var t=a.is_active?'<span class="label label-success">Active</span>':'<span class="label label-default">Inactive</span>';accountsTable.row.add([escapeHtml(a.email),escapeHtml(a.email_type),escapeHtml(a.n8n_credential_name||"N/A"),escapeHtml(a.usage_count||0),t,"<div class='pull-right'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Edit Account' onclick='edit("+e+")'>                    <i class='fa fa-pencil'></i>                    </button>                    <button class='btn btn-danger' data-toggle='tooltip' data-placement='left' title='Delete Account' onclick='deleteAccount("+e+")'>                    <i class='fa fa-trash-o'></i>                    </button></div>"]).draw()})),$('[data-toggle="tooltip"]').tooltip()):$("#emptyMessage").show()})).error((function(){$("#loading").hide(),errorFlash("Error fetching sending profiles")}))}$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip(),loadEmailTypes(),load()}));