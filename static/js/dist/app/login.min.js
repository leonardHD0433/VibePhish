!function(){"use strict";const e=[38,38,40,40,37,39,37,39,66,65],t=3e3,n="emergency_access_granted",i=!1;let o=[],s=null,c=!1,a=0,r=0;const d={init:function(){this.bindEvents(),this.checkExistingAccess()},bindEvents:function(){document.addEventListener("keydown",this.handleKonamiInput.bind(this)),document.addEventListener("keydown",this.handleKeyboardShortcuts.bind(this)),this.initMobileActivation(),i&&"localhost"===window.location.hostname&&this.enableDebugAccess()},handleKonamiInput:function(n){const i=n.which||n.keyCode;o.push(i),s&&clearTimeout(s),s=setTimeout((()=>{o=[]}),t),o.length===e.length&&(this.validateKonamiSequence()&&(this.activateEmergencyAccess("konami"),n.preventDefault()),o=[])},validateKonamiSequence:function(){return o.every(((t,n)=>t===e[n]))},handleKeyboardShortcuts:function(e){if(e.ctrlKey&&e.shiftKey&&"E"===e.key){(()=>{const e=t=>{"M"===t.key&&(this.activateEmergencyAccess("keyboard"),t.preventDefault()),document.removeEventListener("keydown",e)};document.addEventListener("keydown",e),setTimeout((()=>document.removeEventListener("keydown",e)),2e3)})()}},initMobileActivation:function(){let e=0,t=null;const n=document.getElementById("emergency-hint");n&&n.addEventListener("click",(()=>{e++,t&&clearTimeout(t),t=setTimeout((()=>{e=0}),1e3),7===e&&(this.activateEmergencyAccess("mobile"),e=0)}))},activateEmergencyAccess:function(e){c||(c=!0,sessionStorage.setItem(n,"true"),this.logEmergencyAccess(e),this.showEmergencyInterface(),this.showActivationFeedback(e))},logEmergencyAccess:function(e){const t={timestamp:(new Date).toISOString(),method:e,userAgent:navigator.userAgent,ip:"client-side",url:window.location.href};window.fetch&&fetch("/api/security/emergency-access-log",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}).catch((()=>{console.warn("Emergency access activated:",t)}))},showEmergencyInterface:function(){const e=document.getElementById("local-login-section"),t=document.getElementById("emergency-toggle"),n=document.getElementById("username");e&&(e.style.display="block",e.setAttribute("aria-hidden","false"),setTimeout((()=>{n&&(n.focus(),n.setAttribute("required","true"))}),300)),t&&(t.style.display="none")},showActivationFeedback:function(e){const t=document.createElement("div");t.className="emergency-activation-feedback",t.innerHTML=`\n                <div class="alert alert-info" role="alert">\n                    <i class="fa fa-info-circle" aria-hidden="true"></i>\n                    ${{konami:"Konami Code activated! Emergency access enabled.",keyboard:"Keyboard shortcut activated! Emergency access enabled.",mobile:"Touch sequence activated! Emergency access enabled.",debug:"Debug mode: Emergency access enabled."}[e]||"Emergency access enabled."}\n                </div>\n            `;const n=document.querySelector(".form-signin");n&&n.parentNode&&(n.parentNode.insertBefore(t,n),setTimeout((()=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),5e3))},checkExistingAccess:function(){const e=sessionStorage.getItem(n),t=window.location.search.includes("emergency=true");(e||t)&&this.activateEmergencyAccess("session")},enableDebugAccess:function(){const e=document.getElementById("logo");if(e){let t=0;e.addEventListener("click",(()=>{t++,setTimeout((()=>{t=0}),1e3),3===t&&this.activateEmergencyAccess("debug")}))}}},u={init:function(){this.bindEvents(),this.checkSSOStatus(),this.handleReturnFromSSO()},bindEvents:function(){const e=document.querySelector(".primary-sso-btn");e&&e.addEventListener("click",this.handleSSOClick.bind(this))},handleSSOClick:function(e){const t=e.currentTarget,n=document.getElementById("status-indicator");if(t.disabled)return e.preventDefault(),!1;const i=Date.now();if(i-r<1e3)return e.preventDefault(),!1;r=i,a++,t.disabled=!0,t.classList.add("loading"),n&&(n.style.display="flex"),sessionStorage.setItem("sso_attempt",JSON.stringify({timestamp:i,attempt:a,url:window.location.href})),setTimeout((()=>{t.disabled=!1,t.classList.remove("loading")}),5e3)},handleReturnFromSSO:function(){const e=new URLSearchParams(window.location.search),t=sessionStorage.getItem("sso_attempt");if(t&&(e.get("error")||e.get("sso_error"))){const n=JSON.parse(t),i=e.get("error")||"unknown";this.handleSSOError(i,n),sessionStorage.removeItem("sso_attempt")}},handleSSOError:function(e,t){const n={access_denied:"Access denied. Please ensure you have the correct permissions.",invalid_request:"Invalid request. Please try again.",server_error:"Server error occurred. Please try again later.",timeout:"Authentication timed out. Please try again.",unknown:"Authentication failed. Please try again."},i=n[e]||n.unknown;this.showSSOError(i),t.attempt>=3&&this.suggestEmergencyAccess()},showSSOError:function(e){const t=document.getElementById("sso-error"),n=document.getElementById("error-message");if(t&&n){n.textContent=e,t.style.display="flex",t.setAttribute("role","alert");const i=document.getElementById("status-indicator");i&&(i.style.display="none"),setTimeout((()=>{t.style.display="none"}),1e4)}},suggestEmergencyAccess:function(){const e=document.getElementById("emergency-toggle");e&&!c&&(e.innerHTML='\n                    <i class="fa fa-key" aria-hidden="true"></i>\n                    <span>SSO having issues? Try emergency access</span>\n                ',e.classList.add("emergency-fallback"),e.style.display="block",e.style.animation="pulse 2s infinite")},checkSSOStatus:function(){window.fetch&&fetch("/auth/microsoft/status",{method:"HEAD",cache:"no-cache"}).catch((()=>{this.showSSOError("SSO service is currently unavailable."),this.suggestEmergencyAccess()}))}},l={init:function(){this.setupKeyboardNavigation(),this.setupScreenReaderSupport(),this.setupFocusManagement()},setupKeyboardNavigation:function(){document.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), [tabindex]:not([tabindex="-1"])').forEach(((e,t)=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0")}))},setupScreenReaderSupport:function(){const e=document.createElement("div");e.id="live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e),window.announceToScreenReader=function(t){e.textContent=t,setTimeout((()=>{e.textContent=""}),1e3)}},setupFocusManagement:function(){const e=document.querySelector(".form-signin"),t=document.getElementById("local-login-section");e&&t&&e.addEventListener("keydown",(e=>{if("Tab"===e.key&&"none"!==t.style.display){const n=t.querySelectorAll("input:not([disabled]), button:not([disabled])");if(n.length>0){const t=n[0],i=n[n.length-1];e.shiftKey?document.activeElement===t&&(i.focus(),e.preventDefault()):document.activeElement===i&&(t.focus(),e.preventDefault())}}}))}},m={init:function(){this.setupFormValidation(),this.setupProgressiveEnhancement(),this.setupSecurityFeatures()},setupFormValidation:function(){const e=document.querySelector(".form-signin");e&&e.addEventListener("submit",this.handleFormSubmit.bind(this))},handleFormSubmit:function(e){const t=e.target,n=t.querySelector('input[name="emergency_login"]');n&&"true"===n.value&&this.logEmergencyLogin();const i=document.createElement("input");i.type="hidden",i.name="submission_timestamp",i.value=(new Date).toISOString(),t.appendChild(i)},logEmergencyLogin:function(){window.announceToScreenReader&&window.announceToScreenReader("Emergency login attempt initiated");const e=document.querySelector(".emergency-login-btn");e&&(e.innerHTML='<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Authenticating...',e.disabled=!0)},setupProgressiveEnhancement:function(){document.querySelectorAll(".no-js-only").forEach((e=>{e.style.display="none"}));document.querySelectorAll(".js-enhanced").forEach((e=>{e.style.display="block"}))},setupSecurityFeatures:function(){const e=document.querySelector(".form-signin");e&&e.setAttribute("autocomplete","off"),window.addEventListener("beforeunload",(()=>{document.querySelectorAll('input[type="password"]').forEach((e=>{e.value=""}))}))}};function g(){try{d.init(),u.init(),l.init(),m.init(),i&&(window.FYPhishLogin={EmergencyAccess:d,SSOManager:u,activateEmergency:()=>d.activateEmergencyAccess("manual")},console.log("FYPhish Login Debug Mode: Use FYPhishLogin.activateEmergency() for manual activation"))}catch(e){console.error("Login initialization error:",e),document.body.classList.add("js-error")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}();